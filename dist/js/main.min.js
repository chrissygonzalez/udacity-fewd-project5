function initMap(){ko.applyBindings(new locationViewModel)}var locations=[{position:{lat:40.678856,lng:-73.987255},title:"Ample Hills Creamery"},{position:{lat:40.672857,lng:-73.967806},title:"Brooklyn Public Library Central Library"},{position:{lat:40.679724,lng:-73.977934},title:"Gorilla Coffee"},{position:{lat:40.665354,lng:-73.965317},title:"Prospect Park Zoo"},{position:{lat:40.672621,lng:-73.983856},title:"JJ Byrne Park"},{position:{lat:40.67498,lng:-73.988749},title:"Whole Foods"},{position:{lat:40.678246,lng:-73.985748},title:"718 Cyclery"},{position:{lat:40.66958,lng:-73.986611},title:"Owl Farm"},{position:{lat:40.680887,lng:-73.975871},title:"A. Cheng"},{position:{lat:40.680557,lng:-73.975152},title:"Bklyn Larder"},{position:{lat:40.674363,lng:-73.981648},title:"La Villa"},{position:{lat:40.679625,lng:-73.984193},title:"Brooklyn Boulders"},{position:{lat:40.677606,lng:-73.984065},title:"Dinosaur Bar-B-Que"},{position:{lat:40.677282,lng:-73.980109},title:"Konditori"},{position:{lat:40.674588,lng:-73.975089},title:"Roma Pizza"},{position:{lat:40.670267,lng:-73.97897},title:"Mr. Falafel"},{position:{lat:40.666512,lng:-73.981649},title:"Buttermilk Bakeshop"},{position:{lat:40.665231,lng:-73.982654},title:"Cafe Grumpy"},{position:{lat:40.666869,lng:-73.984626},title:"Bar Toto"},{position:{lat:40.663868,lng:-73.983718},title:"A Shoe Grows in Brooklyn"}],locationViewModel=function(){var a=this;a.isMenuClosed=ko.observable(!1),a.searchValue=ko.observable(""),a.mapCenter={lat:40.678473,lng:-73.978521},a.map=new google.maps.Map(document.getElementById("map"),{center:a.mapCenter,scrollwheel:!1,zoom:15,mapTypeControl:!1,styles:[{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#E0E0CD"}]},{featureType:"road",stylers:[{color:"#F7F7E7"}]},{featureType:"water",stylers:[{color:"#C1C9DB"}]},{featureType:"poi.park",stylers:[{color:"#CBE2B3"}]},{elementType:"labels.text.fill",stylers:[{color:"#939378"}]},{featureType:"poi.medical",elementType:"geometry",stylers:[{color:"#E2DBB1"}]},{featureType:"poi.school",elementType:"geometry",stylers:[{color:"#E2DBB1"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]}]}),a.bounds=new google.maps.LatLngBounds,a.locationList=ko.observableArray([]),a.initList=function(){locations.forEach(function(b){a.locationList.push(new Location(b,a.map,a))})},a.initList(),a.map.fitBounds(a.bounds),a.currentLocation=ko.observable(a.locationList()[0]),a.infoWindow=new google.maps.InfoWindow({content:a.currentLocation().title(),pixelOffset:new google.maps.Size(0,-30)}),a.openWindow=function(b){a.infoWindow.open(a.map)},a.changeLocation=function(b){a.currentLocation(b),a.infoWindow.setPosition(b.position)},a.updateInfoWindow=function(b,c,d){var e="";c&&(e+='<img src="'+c+'" alt="Flickr photo">'),e+=d?'<p><span class="bold">'+b.title()+"</span><br>"+d+"</p>":'<p class="bold">'+b.title()+"</p>",a.infoWindow.setContent(e)},a.toggleActive=function(b){a.allInactive(),b.isActive(!b.isActive())},a.allInactive=function(){for(var b=0;b<a.locationList().length;b++)a.locationList()[b].isActive(!1),a.locationList()[b].marker.setAnimation(google.maps.Animation["null"])},google.maps.event.addListener(a.infoWindow,"closeclick",function(){a.allInactive()}),a.getApiData=function(b){var c=b.title,d=b.position,e=b.title(),f=e.split(" ").join("+");$.when($.ajax({url:"https://api.foursquare.com/v2/venues/search?ll="+d.lat+","+d.lng+"&intent=match&query="+c()+"&client_id=RBVKWXN2WH0OQLFMDGKAKNIAIPOLODHEKBLYIHMCQYX3AKJ0&client_secret=LUFOAZGAL4BYJJKBGY2ZJ0MNHRXFS0DOTKCWIW0GXYUI4X1X&v=20151018",context:document.body}),$.ajax({url:"https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=d9e2b24a8f57f49550dccb519a8081a2&text="+f+"&lat="+d.lat+"&lon="+d.lng+"&per_page=1&format=json&nojsoncallback=1",context:document.body})).done(function(c,d){var e,f,g,h;c[0].response.venues[0]?(e=c[0].response.venues[0],f=e.location.formattedAddress.join("<br>"),g=e.contact.formattedPhone,h=f,g&&(h=h+"<br>"+g)):h=null;var i=d[0].photos.photo[0].farm,j=d[0].photos.photo[0].server,k=d[0].photos.photo[0].id,l=d[0].photos.photo[0].secret,m="https://farm"+i+".staticflickr.com/"+j+"/"+k+"_"+l+"_q.jpg";a.updateInfoWindow(b,m,h),a.changeLocation(b),a.map.panTo(b.position),a.openWindow(),a.toggleActive(b),b.marker.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){b.marker.setAnimation(null)},2100)}).fail(function(a,b,c){alert("Oops, we seem to be having trouble getting location data! Sorry for the difficulties. Please try again later.")})},a.onClick=function(b){a.getApiData(b),a.isMenuClosed()||a.isMenuClosed(!0)},a.clearSearch=function(){a.searchValue("")},a.toggleMenu=function(){a.isMenuClosed(!a.isMenuClosed()),console.log(a.isMenuClosed())},a.filterList=ko.computed(function(){for(var b=a.locationList().length,c=a.searchValue().toLowerCase(),d=0;b>d;d++){var e=a.locationList()[d].title().toLowerCase();e.indexOf(c)<0?(a.locationList()[d].marker.setVisible(!1),a.locationList()[d]._destroy(!0)):(a.locationList()[d].marker.setVisible(!0),a.locationList()[d]._destroy(!1))}a.infoWindow.close(),a.allInactive()})},Location=function(a,b,c){var d=this;this.map=b,this.position=a.position,this.title=ko.observable(a.title),this.marker=new google.maps.Marker({map:this.map,position:this.position,title:this.title(),icon:"img/bluepin.svg"}),c.bounds.extend(new google.maps.LatLng(this.position.lat,this.position.lng)),this.marker.addListener("click",function(){c.onClick(d)}),this.isActive=ko.observable(!1),this._destroy=ko.observable(!1)};